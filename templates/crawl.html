<!DOCTYPE html>
<html>
<head>
    <title>Crawl Tool</title>
    <link href="/static/style.css" rel="stylesheet">
    <script>
        let ws;
        function startWS() {
            ws = new WebSocket("{{'wss://' if request.url.scheme=='https' else 'ws://'}}" + window.location.host + "/ws-crawl/{{ session_id }}");
            ws.onmessage = function(event) {
                let logArea = document.getElementById("logs");
                if(event.data.startsWith("DONE:")) {
                    let fname = event.data.split("DONE:")[1].trim();
                    document.getElementById("download-link").innerHTML = '<a href="/static/' + fname + '" target="_blank">Tải kết quả Excel</a>';
                } else {
                    logArea.value += event.data + "\n";
                    logArea.scrollTop = logArea.scrollHeight;
                }
            }
        }
        window.onload = startWS;
    </script>
</head>
<body>
<div class="top-bar">
    <a href="/dashboard">Dashboard</a>
    <a href="/upload">Thêm/Xoá Schema</a>
    <a href="/crawl">Crawl dữ liệu</a>
    <a href="/logout" class="logout">Logout</a>
</div>
<div class="content">
    <h2>Crawl dữ liệu từ URL</h2>
    <form method="post" action="/crawl" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <button type="submit">Bắt đầu crawl</button>
    </form>
    <textarea id="logs" rows="15" style="width:100%;margin-top:12px" readonly></textarea>
    <div id="download-link" style="margin-top:12px"></div>
</div>
</body>
</html>
