<!DOCTYPE html>
<html>
<head>
    <title>Schema Tool</title>
    <link href="/static/style.css" rel="stylesheet">
    <script>
        let ws;
        function startWS() {
            ws = new WebSocket("{{'wss://' if request.url.scheme=='https' else 'ws://'}}" + window.location.host + "/ws-upload/{{ session_id }}");
            ws.onmessage = function(event) {
                let logArea = document.getElementById("logs");
                if(event.data.startsWith("DONE")) {
                    let fname = event.data.slice(4).trim();
                    document.getElementById("download-link").innerHTML = '<a href="/static/' + fname + '" target="_blank">Tải kết quả Excel</a>';
                } else {
                    logArea.value += event.data + "\n";
                    logArea.scrollTop = logArea.scrollHeight;
                }
            }
        }
        window.onload = startWS;
    </script>
</head>
<body>
<div class="top-bar">
    <a href="/dashboard">Dashboard</a>
    <a href="/upload">Thêm/Xoá Schema</a>
    <a href="/crawl">Crawl dữ liệu</a>
    <a href="/logout" class="logout">Logout</a>
</div>
<div class="content">
    <h2>Thêm/Xoá Schema hàng loạt</h2>
    <form method="post" action="/upload" enctype="multipart/form-data">
        <select name="action">
            <option value="chencode">Thêm/Cập nhật schema</option>
            <option value="xoascript">Xoá schema</option>
        </select>
        <input type="file" name="file" required>
        <button type="submit">Bắt đầu xử lý</button>
    </form>
    <textarea id="logs" rows="15" style="width:100%;margin-top:12px" readonly></textarea>
    <div id="download-link" style="margin-top:12px"></div>
</div>
</body>
</html>
